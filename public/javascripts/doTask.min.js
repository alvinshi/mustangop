var app=angular.module("yemaWebApp",[]),navIndex=0;app.controller("doTaskCtrl",function($scope,$http){function getTaskData(taskType,pageCount){var url="doTask/taskHall/"+pageCount+"/"+taskType;$http.get(url).success(function(response){if($scope.isLoadingMyApp=!1,0==pageCount&&void 0!=response.myAppCount&&(myAppCountDic[taskType]=response.myAppCount),"allTask"==taskType){$scope.taskDisplayed=$scope.taskDisplayed.concat(response.allTask);for(var i=0;i<response.allTask;i++)0!=response.allTask[i].myTask&&(response.allTask[i].mode=!0);for(var j=0;j<response.allTask;i++)response.allTask[j].hasChanged=!1;$scope.disableTaskCount=response.disableTaskCount}else"commentTask"==taskType?$scope.commentTask=$scope.commentTask.concat(response.allTask):"downTask"==taskType?$scope.downTask=$scope.downTask.concat(response.allTask):"inactiveTask"==taskType&&($scope.inactiveTask=$scope.inactiveTask.concat(response.allTask),$scope.disableTaskCount=response.disableTaskCount);$scope.hasMoreDic[taskType]=response.hasMore})}$("#myCarousel").carousel({interval:5e3}),$scope.releaseTaskVideo=function(){$("#releaseTaskVideo").modal("hide");var myVideo=document.getElementById("releaseTask");myVideo.pause()},$scope.getTaskVideo=function(){$("#getTaskVideo").modal("hide");var myVideo=document.getElementById("getTask");myVideo.pause()},$scope.uploadTaskVideo=function(){$("#uploadTaskVideo").modal("hide");var myVideo=document.getElementById("uploadTask");myVideo.pause()},$scope.planeColor=!0,$scope.changePlaneColor=function(){$scope.planeColor=!$scope.planeColor},$scope.noApp=!1,$scope.disableTaskCount=0,$scope.hasMoreDic={allTask:1,commentTask:1,downTask:1,inactiveTask:1};var myAppCountDic={allTask:0,commentTask:0,downTask:0};$scope.taskDisplayed=[],$scope.commentTask=[],$scope.downTask=[],$scope.inactiveTask=[],getTaskData("allTask",0),$scope.displayAll=function(){void 0==$scope.taskDisplayed||0==$scope.taskDisplayed.length?getTaskData("allTask",0):1==$scope.hasMoreDic.allTask&&getTaskData("allTask",$scope.taskDisplayed.length-myAppCountDic.allTask)},$scope.commentTasksOnly=function(){void 0==$scope.commentTask||0==$scope.commentTask.length?getTaskData("commentTask",0):1==$scope.hasMoreDic.commentTask&&getTaskData("commentTask",$scope.commentTask.length-myAppCountDic.commentTask)},$scope.downloadTasksOnly=function(){void 0==$scope.downTask||0==$scope.downTask.length?getTaskData("downTask",0):1==$scope.hasMoreDic.downTask&&getTaskData("downTask",$scope.downTask.length-myAppCountDic.downTask)},$scope.inactiveTasksOnly=function(){void 0==$scope.inactiveTask||0==$scope.inactiveTask.length?getTaskData("inactiveTask",0):getTaskData("inactiveTask",$scope.inactiveTask.length)},$scope.getTaskMarkStr=void 0,$scope.getTask=function(currentApp){var username=getCookie("username");if(""==username)currentApp.getTaskErrorId=-200,currentApp.errorMsg="请先登陆帐号后再领取任务";else if(parseInt(currentApp.receiveCount)!=currentApp.receiveCount)currentApp.getTaskErrorId=-200,currentApp.errorMsg="请填写正确的领取条目";else if(currentApp.receiveCount>currentApp.remainCount)currentApp.getTaskErrorId=-200,currentApp.errorMsg="此任务无法领取更多";else if(currentApp.receiveCount>9)currentApp.getTaskErrorId=-200,currentApp.errorMsg="每个任务最多领取10条";else{currentApp.isGetingTask=!0;var url="doTask/postUsertask/"+currentApp.objectId+"/"+currentApp.rateUnitPrice+"/"+currentApp.appObjectId,postData={receiveCount:currentApp.receiveCount,detailRem:currentApp.detailRem,excUniqueCode:currentApp.excUniqueCode};$http.post(url,postData).success(function(response){console.log(response),currentApp.getTaskErrorId=response.errorId,0!=response.errorId?(currentApp.errorMsg=response.errorMsg,currentApp.isGetingTask=!1):currentApp.errorMsg="";for(var dataAllTypeList=[$scope.taskDisplayed,$scope.commentTask,$scope.downTask],i=0;i<dataAllTypeList.length;i++)for(var taskList=dataAllTypeList[i],j=0;j<taskList.length;j++){var taskObect=taskList[j];taskObect.appleId==currentApp.appleId&&(taskList.disable=!0,$scope.inactiveTask.push(taskObect),$scope.disableTaskCount=$scope.disableTaskCount+1)}})}},$scope.refresh=function(){location.reload()},$scope.showDiv=function(app){1!=app.myTask&&(app.mode=!0)},$scope.hideDiv=function(app){app.mode=!1},$scope.filtrateApp=function(appInfo){$("#markApp").modal("show");var needToSave={appObjectId:appInfo.appObjectId,excUniqueCode:appInfo.excUniqueCode,taskObjectId:appInfo.objectId};$scope.confirmAdd=function(app){var fiterAppUrl="doTask/fiterApp";$http.post(fiterAppUrl,needToSave).success(function(response){$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,0==response.errorId&&($scope.hasChanged=!0)})}}});