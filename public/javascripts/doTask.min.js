var app=angular.module("yemaWebApp",[]),navIndex=0;app.controller("doTaskCtrl",function($scope,$http){function taskDisplayedInit(){$scope.totalTaskNum=$scope.taskObject.length,$scope.taskPerPage=10,$scope.totalTaskNum%$scope.taskPerPage==0?$scope.totalPageNum=parseInt($scope.totalTaskNum/$scope.taskPerPage)+1:$scope.totalPageNum=parseInt($scope.totalTaskNum/$scope.taskPerPage)+2}function updateTaskDisplayed(){var firstTaskIndex=$scope.pageNum*$scope.taskPerPage,lastTaskIndex=Math.min(firstTaskIndex+$scope.taskPerPage,$scope.totalTaskNum);$scope.taskDisplayed=$scope.taskObject.slice(firstTaskIndex,lastTaskIndex)}$scope.planeColor=!0,$scope.changePlaneColor=function(){$scope.planeColor=!$scope.planeColor},$scope.noApp=!1;var url="doTask/taskHall";$scope.pageNum=0,$scope.totalPageNum=0,$scope.inactiveTasks=new Array,$http.get(url).success(function(response){if(0==response.doTask.length)$scope.noApp=!0;else{$scope.allTaskObjects=new Array,$scope.downloadTasks=new Array,$scope.commentTasks=new Array,$scope.inactiveTasks=new Array;for(var i=0;i<response.doTask.length;i++)response.doTask[i].inactive||"0"==response.doTask[i].remainCount?$scope.inactiveTasks.push(response.doTask[i]):"下载"==response.doTask[i].taskType?($scope.allTaskObjects.push(response.doTask[i]),$scope.downloadTasks.push(response.doTask[i])):($scope.allTaskObjects.push(response.doTask[i]),$scope.commentTasks.push(response.doTask[i]));$scope.allTaskObjects.sort(function(a,b){return a.createdAt>b.createdAt?1:-1}),$scope.downloadTasks.sort(function(a,b){return a.createdAt>b.createdAt?1:-1}),$scope.commentTasks.sort(function(a,b){return a.createdAt>b.createdAt?1:-1}),$scope.inactiveTasks.sort(function(a,b){return a.createdAt>b.createdAt?1:-1}),$scope.taskObject=$scope.allTaskObjects,taskDisplayedInit(),updateTaskDisplayed()}}),$scope.displayAll=function(){$scope.taskObject=$scope.allTaskObjects,$scope.pageNum=0,taskDisplayedInit(),updateTaskDisplayed()},$scope.downloadTasksOnly=function(){$scope.taskObject=$scope.downloadTasks,$scope.pageNum=0,taskDisplayedInit(),updateTaskDisplayed()},$scope.commentTasksOnly=function(){$scope.taskObject=$scope.commentTasks,$scope.pageNum=0,taskDisplayedInit(),updateTaskDisplayed()},$scope.inactiveTasksOnly=function(){$scope.taskObject=$scope.inactiveTasks,$scope.pageNum=0,taskDisplayedInit(),updateTaskDisplayed()},$scope.pageNum=0,$scope.nextPage=function(){$scope.pageNum+2<$scope.totalPageNum?$scope.pageNum++:console.log("Already reached the last page"),updateTaskDisplayed()},$scope.prevPage=function(){$scope.pageNum>0?$scope.pageNum--:console.log("It is the first page"),updateTaskDisplayed()},$scope.getTaskFormData={},$scope.getTaskFormData.receiveCount=void 0,$scope.getTaskFormData.detailRem=void 0,$scope.getTaskFormData.errorMsg=void 0,$scope.getTaskFormData.result=!1,$scope.getTask=function(currentApp){var username=getCookie("username");if(""==username)$scope.getTaskFormData.errorMsg="请先登陆帐号后再领取任务";else if(0==$scope.getTaskFormData.receiveCount)$scope.getTaskFormData.errorMsg="请正确填写领取条目";else if(parseInt($scope.getTaskFormData.receiveCount)!=$scope.getTaskFormData.receiveCount)$scope.getTaskFormData.errorMsg="请正确填写领取条目";else if($scope.getTaskFormData.receiveCount>parseInt(currentApp.remainCount))$scope.getTaskFormData.errorMsg="此任务剩余条数不足";else{var url="doTask/postUsertask/"+currentApp.objectId+"/"+currentApp.rateUnitPrice+"/"+currentApp.appObjectId,postData={receiveCount:$scope.getTaskFormData.receiveCount,detailRem:$scope.getTaskFormData.detailRem,latestReleaseDate:currentApp.latestReleaseDate};$http.post(url,postData).success(function(response){console.log(response),$scope.getTaskFormData.errorMsg=response.errorMsg,$scope.getTaskFormData.result=response.succeeded})}},$scope.refresh=function(){location.reload()}});