var app=angular.module("yemaWebApp",[]),navIndex=0;app.controller("doTaskCtrl",function($scope,$http){function getTaskData(taskType,pageCount){var url="doTask/taskHall/"+pageCount+"/"+taskType;$http.get(url).success(function(response){if("allTask"==taskType){$scope.taskDisplayed=$scope.taskDisplayed.concat(response.allTask);for(var i=0;i<response.allTask;i++)response.allTask[i].mode=!0;$scope.disableTaskCount=response.disableTaskCount}else"commentTask"==taskType?$scope.commentTask=$scope.commentTask.concat(response.allTask):"downTask"==taskType?$scope.downTask=$scope.downTask.concat(response.allTask):"inactiveTask"==taskType&&($scope.inactiveTask=$scope.inactiveTask.concat(response.allTask),$scope.disableTaskCount=response.disableTaskCount);$scope.hasMoreDic[taskType]=response.hasMore})}$("#myCarousel").carousel({interval:5e3}),$scope.releaseTaskVideo=function(){$("#releaseTaskVideo").modal("hide");var myVideo=document.getElementById("releaseTask");myVideo.pause()},$scope.getTaskVideo=function(){$("#getTaskVideo").modal("hide");var myVideo=document.getElementById("getTask");myVideo.pause()},$scope.uploadTaskVideo=function(){$("#uploadTaskVideo").modal("hide");var myVideo=document.getElementById("uploadTask");myVideo.pause()},$scope.planeColor=!0,$scope.changePlaneColor=function(){$scope.planeColor=!$scope.planeColor},$scope.noApp=!1,$scope.disableTaskCount=0,$scope.hasMoreDic={allTask:1,commentTask:1,downTask:1,inactiveTask:1},$scope.taskDisplayed=[],$scope.commentTask=[],$scope.downTask=[],$scope.inactiveTask=[],getTaskData("allTask",0),$scope.displayAll=function(){void 0==$scope.taskDisplayed||0==$scope.taskDisplayed.length?getTaskData("allTask",0):getTaskData("allTask",$scope.taskDisplayed.length)},$scope.commentTasksOnly=function(){void 0==$scope.commentTask||0==$scope.commentTask.length?getTaskData("commentTask",0):getTaskData("commentTask",$scope.commentTask.length)},$scope.downloadTasksOnly=function(){void 0==$scope.downTask||0==$scope.downTask.length?getTaskData("downTask",0):getTaskData("downTask",$scope.downTask.length)},$scope.inactiveTasksOnly=function(){void 0==$scope.inactiveTask||0==$scope.inactiveTask.length?getTaskData("inactiveTask",0):getTaskData("inactiveTask",$scope.inactiveTask.length)},$scope.getTaskFormData={},$scope.getTaskFormData.receiveCount=void 0,$scope.getTaskFormData.detailRem=void 0,$scope.getTaskFormData.errorMsg=void 0,$scope.getTaskFormData.result=!1,$scope.getTask=function(currentApp){var username=getCookie("username");if(""==username)$scope.getTaskFormData.errorMsg="请先登陆帐号后再领取任务";else if(0==$scope.getTaskFormData.receiveCount)$scope.getTaskFormData.errorMsg="请正确填写领取条目";else if(parseInt($scope.getTaskFormData.receiveCount)!=$scope.getTaskFormData.receiveCount)$scope.getTaskFormData.errorMsg="请正确填写领取条目";else if($scope.getTaskFormData.receiveCount>parseInt(currentApp.remainCount))$scope.getTaskFormData.errorMsg="此任务剩余条数不足";else{var url="doTask/postUsertask/"+currentApp.objectId+"/"+currentApp.rateUnitPrice+"/"+currentApp.appObjectId,postData={receiveCount:$scope.getTaskFormData.receiveCount,detailRem:$scope.getTaskFormData.detailRem,latestReleaseDate:currentApp.latestReleaseDate};$http.post(url,postData).success(function(response){console.log(response),$scope.getTaskFormData.errorMsg=response.errorMsg,$scope.getTaskFormData.result=response.succeeded;for(var dataAllTypeList=[$scope.taskDisplayed,$scope.commentTask,$scope.downTask],i=0;i<dataAllTypeList.length;i++)for(var taskList=dataAllTypeList[i],j=0;j<taskList.length;j++){var taskObect=taskList[j];taskObect.appleId==currentApp.appleId&&(taskList.disable=!0,$scope.inactiveTask.push(taskObect),$scope.disableTaskCount=$scope.disableTaskCount+1)}})}},$scope.refresh=function(){location.reload()},$scope.showDiv=function(app){app.mode=!0},$scope.hideDiv=function(app){app.mode=!1},$scope.filtrateApp=function(app){$("#markApp").modal("show")}});