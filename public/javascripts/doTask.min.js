var app=angular.module("yemaWebApp",[]),navIndex=0;app.controller("doTaskCtrl",function(a,b,c){function d(){a.totalTaskNum=a.taskObject.length,a.taskPerPage=10,a.totalTaskNum%a.taskPerPage==0?a.totalPageNum=parseInt(a.totalTaskNum/a.taskPerPage)+1:a.totalPageNum=parseInt(a.totalTaskNum/a.taskPerPage)+2}function e(){firstTaskIndex=a.pageNum*a.taskPerPage,lastTaskIndex=Math.min(firstTaskIndex+a.taskPerPage,a.totalTaskNum),a.taskDisplayed=a.taskObject.slice(firstTaskIndex,lastTaskIndex)}a.planeColor=!0,a.changePlaneColor=function(){a.planeColor=!a.planeColor},a.noApp=!1;var f="doTask/taskHall";a.pageNum=0,a.totalPageNum=0,a.inactiveTasks=new Array,b.get(f).success(function(b){if(0==b.doTask.length)a.noApp=!0;else{a.allTaskObjects=new Array,a.downloadTasks=new Array,a.commentTasks=new Array,a.inactiveTasks=new Array;for(var c=0;c<b.doTask.length;c++)b.doTask[c].inactive||"0"==b.doTask[c].remainCount?a.inactiveTasks.push(b.doTask[c]):"下载"==b.doTask[c].taskType?(a.allTaskObjects.push(b.doTask[c]),a.downloadTasks.push(b.doTask[c])):(a.allTaskObjects.push(b.doTask[c]),a.commentTasks.push(b.doTask[c]));a.allTaskObjects.sort(function(a,b){return a.createdAt<=b.createdAt}),a.downloadTasks.sort(function(a,b){return a.createdAt<=b.createdAt}),a.commentTasks.sort(function(a,b){return a.createdAt<=b.createdAt}),a.inactiveTasks.sort(function(a,b){return a.createdAt<=b.createdAt}),a.taskObject=a.allTaskObjects,d(),e()}}),a.displayAll=function(){a.taskObject=a.allTaskObjects,a.pageNum=0,d(),e()},a.downloadTasksOnly=function(){a.taskObject=a.downloadTasks,a.pageNum=0,d(),e()},a.commentTasksOnly=function(){a.taskObject=a.commentTasks,a.pageNum=0,d(),e()},a.inactiveTasksOnly=function(){a.taskObject=a.inactiveTasks,a.pageNum=0,d(),e()},a.pageNum=0,a.nextPage=function(){a.pageNum+2<a.totalPageNum?a.pageNum++:console.log("Already reached the last page"),e()},a.prevPage=function(){a.pageNum>0?a.pageNum--:console.log("It is the first page"),e()},a.getTaskFormData={},a.getTaskFormData.receiveCount=void 0,a.getTaskFormData.detailRem=void 0,a.getTaskFormData.errorMsg=void 0,a.getTaskFormData.result=!1,a.getTask=function(c){var d=getCookie("username");if(""==d)a.getTaskFormData.errorMsg="请先登陆帐号后再领取任务";else if(0==a.getTaskFormData.receiveCount)a.getTaskFormData.errorMsg="请正确填写领取条目";else if(parseInt(a.getTaskFormData.receiveCount)!=a.getTaskFormData.receiveCount)a.getTaskFormData.errorMsg="请正确填写领取条目";else if(a.getTaskFormData.receiveCount>parseInt(c.remainCount))a.getTaskFormData.errorMsg="此任务剩余条数不足";else{var e="doTask/postUsertask/"+c.objectId+"/"+c.rateUnitPrice+"/"+c.appObjectId,f={receiveCount:a.getTaskFormData.receiveCount,detailRem:a.getTaskFormData.detailRem,latestReleaseDate:c.latestReleaseDate};b.post(e,f).success(function(b){a.getTaskFormData.errorMsg=b.errorMsg,a.getTaskFormData.result=b.succeeded})}},a.refresh=function(){location.reload()}});