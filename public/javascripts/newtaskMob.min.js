var app=angular.module("yemaWebApp",["angularFileUpload"]),navIndex=2;app.controller("MobControl",function(a,b,c,d){function e(a,b){console.log("runned");var c=new FileReader;c.addEventListener("load",function(c){var d=c.target.result;f(d,a,b)},!1),c.readAsDataURL(a[b]._file)}function f(b,c,d){var f=new Image;f.src=b,f.onload=function(){var b=document.createElement("canvas");b.width=f.naturalWidth,b.height=f.naturalHeight,b.getContext("2d").drawImage(f,0,0);var h=.3,i=b.toDataURL("image/jpg",h),j=g(i);c[d]._file=j,d++,console.log("compressed"),d==c.length?(a.progressNum=50,k.uploadAll()):e(c,d)}}function g(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/jpeg"})}var h=c.absUrl().split("/"),i=h[h.length-1],j="/newtaskMobile/claim/"+i;b.get(j).success(function(b){a.oneAppInfo=b.oneAppInfo,a.images=b.macTask});var k=a.uploader=new d({url:"/upload/img",queueLimit:3});k.filters.push({name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|".indexOf(c)!==-1}}),a.deletFile=function(){k.clearQueue()};var l=new Array;k.onAfterAddingFile=function(a){},k.onAfterAddingAll=function(b){a.progressNum=10,e(b,0),console.info("onAfterAddingAll",b)},k.onProgressAll=function(a){console.info("onProgressAll",a)},k.onSuccessItem=function(a,b,c,d){console.info("onSuccessItem",a,b,c,d)},k.onErrorItem=function(a,b,c,d){console.info("onErrorItem",a,b,c,d)},k.onCancelItem=function(a,b,c,d){console.info("onCancelItem",a,b,c,d)},k.onCompleteItem=function(a,b,c,d){l.push(b.fileUrlList[0]),console.info("onCompleteItem",a,b,c,d)},k.onCompleteAll=function(){console.info("onCompleteAll");var c="/newtaskMobile/add/"+i;a.progressNum=80,b.post(c,{uploadName:a.uploadName,requirementImgs:l}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.oneAppInfo.uploadName=b.uploadName,a.images=b.requirementImgs,a.progressNum=0,k.clearQueue(),l=new Array})},console.info("uploader",k),a.normalBtnShow=1,getCookie("uploadImgName").length>0?a.normalBtnShow=0:a.normalBtnShow=1,a.saveUploadName=function(){void 0!=a.uploadName&&a.uploadName.length>0?(a.uploadNameError="",a.normalBtnShow=0):a.uploadNameError="昵称不能为空"},a.commitConfirm=function(){location.href="/myClaim/"+a.oneAppInfo.userObjectId}});