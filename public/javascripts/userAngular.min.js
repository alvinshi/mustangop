var app=angular.module("userAccountApp",[]);app.controller("userAccountCtrl",function(a,b){function c(a){if(0==a.length)return alert("手机号码未填写！"),!1;if(11!=a.length)return alert("请输入有效的手机号码！"),!1;var b=/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;return!!b.test(a)||(alert("请输入有效的手机号码！"),!1)}a.displayMsg=function(){console.log(a.errorMsg),"Could not find user"===a.errorMsg?$(".alert").text("无法找到用户"):"The username and password mismatch."===a.errorMsg?$(".alert").text("用户名与密码不符"):$(".alert").text(a.errorMsg)},a.userRegister=function(){var c="/user/register";console.log(a.userSmsCode),b.post(c,{mobile:a.userMobile,password:a.userSecret,smsCode:a.userSmsCode}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.displayMsg(),0==b.errorId&&(location.href="/myapp")})},a.userLogin=function(){var c="/user/login";console.log(a.userSmsCode),b.post(c,{mobile:a.userMobile,password:a.userSecret}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.displayMsg(),0==b.errorId&&(location.href="/myapp")})},a.getNewSmsCode=function(){function c(a){return 0===a?($("#button1").attr("disabled",!1),void $("#button1").text("重获验证码")):($("#button1").text(a+"s后重试"),a--,void setTimeout(function(){c(a)},1e3))}if(""!=a.searchUrl){var d="/user/getNewSmsCode";console.log(d),$("#button1").prop("disabled",!0);var e=60;c(e),b.post(d,{mobile:a.userMobile,password:a.userSecret}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.displayMsg()})}},a.newSecret=function(){var c="/user/forgetSecret";console.log(a.userSmsCode),b.post(c,{mobile:a.userMobile,smsCode:a.newSmsCode,newPassword:a.usernewSecret}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.displayMsg(),0==b.errorId&&(location.href="/user/login")})};var d=function(d){$("#getSmsBtn").click(function(e){function f(a){0===a?($("#getSmsBtn").attr("disabled",!1),$("#getSmsBtn").text("获取验证码")):($("#getSmsBtn").text(a+"s后重试"),a--,setTimeout(function(){f(a)},1e3))}if(void 0==a.userMobile||void 0==a.userSecret)return void alert("手机号和密码必填哦");var g=c(a.userMobile);if(1==g){var h=/^(\w){6,20}$/;if(!h.exec(a.userSecret))return void alert("密码由6-20个字母/数字或下划线组成");if(1==g){var i=d.getValidate();if(i){$("#getSmsBtn").prop("disabled",!0);var j=60;f(j);var k="/user/getSmsCode",l={geetest_challenge:i.geetest_challenge,geetest_validate:i.geetest_validate,geetest_seccode:i.geetest_seccode,mobile:a.userMobile,password:a.userSecret};b.post(k,l).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,a.displayMsg()})}else $("#notice")[0].className="show",setTimeout(function(){$("#notice")[0].className="hide"},2e3)}}}),d.appendTo("#embed-captcha"),d.onReady(function(){$("#wait")[0].className="hide"})};$.ajax({url:"/user/pc-geetest/register?t="+(new Date).getTime(),type:"get",dataType:"json",success:function(a){initGeetest({gt:a.gt,challenge:a.challenge,product:"embed",offline:!a.success},d)}})});