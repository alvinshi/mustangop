function logout(){clearCookie("userIdCookie"),clearCookie("username"),location.href="/"}var app=angular.module("yemaWebApp",["ui.router"]),navIndex=6;app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("inform",{url:"/",templateUrl:"/html/userCenter-infor.html",controller:"userCenterCtrl"}).state("account",{url:"/account",templateUrl:"/html/userCenter-account.html",controller:"userCenterCtrl"}).state("inforManage",{url:"/inforManage",templateUrl:"/html/userCenter-inforManage.html",controller:"inforManageCtrl"}).state("taskHistory",{url:"/taskHistory",templateUrl:"/html/userCenter-taskHistory.html",controller:"taskHistoryCtrl"})}]),app.controller("inforManageCtrl",function($scope,$http){function dateCompare(DateA,DateB){var a=new Date(DateA),b=new Date(DateB),msDateA=Date.UTC(a.getFullYear(),a.getMonth()+1,a.getDate()),msDateB=Date.UTC(b.getFullYear(),b.getMonth()+1,b.getDate());return parseFloat(msDateA)<parseFloat(msDateB)?a.getDate()-b.getDate()==-1?"昨天":"更早":parseFloat(msDateA)==parseFloat(msDateB)?"今天":parseFloat(msDateA)>parseFloat(msDateB)?"未来":void console.log("fail")}function getTotalPageNum(totalTaskNum,msgPerPage){return totalTaskNum%msgPerPage==0?parseInt(totalTaskNum/msgPerPage)+1:parseInt(totalTaskNum/msgPerPage)+2}function updateMsgDisplayed(){firstTaskIndex=$scope.msgPerPage*$scope.pageNum,lastTaskIndex=firstTaskIndex+$scope.msgPerPage,$scope.taskMsgDisplayed=$scope.taskDisplayed.slice(firstTaskIndex,lastTaskIndex);for(var msgIdArray=new Array,i=0;i<$scope.taskMsgDisplayed.length;i++)msgIdArray.push($scope.taskMsgDisplayed[i].id);var url="/user/userCenter/readMsg";$http.post(url,{msgIdArray:msgIdArray}).success(function(response){})}$scope.userName=!0;var date=new Date;$scope.pageNum=0,$scope.msgPerPage=6;var firstTaskIndex=0,lastTaskIndex=$scope.msgPerPage,getMessage="/user/userCenter/getMessage";$http.get(getMessage).success(function(response){$scope.myId=response.yourId,console.log($scope.myId);var messages=response.rtnMsg;$scope.taskMsg=new Array,$scope.systemMsg=new Array,$scope.moneyMsg=new Array,$scope.unreadMsg=!1,$scope.unreadTaskMsg=!1,$scope.unreadSystemMsg=!1,$scope.unreadMoneyMsg=!1;for(var i=0;i<messages.length;i++)"今天"==dateCompare(messages[i].time,date)?messages[i].day="今天":"昨天"==dateCompare(messages[i].time,date)?messages[i].day="昨天":messages[i].day=messages[i].time,"任务"==messages[i].category?($scope.taskMsg.push(messages[i]),0==messages[i].read&&($scope.unreadTaskMsg=!0)):"系统"==messages[i].category?($scope.systemMsg.push(messages[i]),0==messages[i].read&&($scope.unreadSystemMsg=!0)):($scope.moneyMsg.push(messages[i]),0==messages[i].read&&($scope.unreadMoneyMsg=!0));($scope.unreadTaskMsg||$scope.unreadMoneyMsg||$scope.unreadMoneyMsg)&&($scope.unreadMsg=!0),$scope.taskDisplayed=$scope.taskMsg,$scope.totalTaskNum=$scope.taskDisplayed.length,$scope.totalPageNum=getTotalPageNum($scope.totalTaskNum,$scope.msgPerPage),updateMsgDisplayed()}),$scope.msgClick=function(type){$scope.pageNum=0,"task"==type?$scope.taskDisplayed=$scope.taskMsg:"system"==type?$scope.taskDisplayed=$scope.systemMsg:"money"==type&&($scope.taskDisplayed=$scope.moneyMsg),$scope.totalPageNum=getTotalPageNum($scope.totalTaskNum,$scope.msgPerPage),0!=$scope.taskDisplayed.length&&(firstTaskIndex=0,lastTaskIndex=$scope.msgPerPage,updateMsgDisplayed())},$scope.nextPage=function(){$scope.pageNum+2<$scope.totalPageNum?$scope.pageNum++:console.log("Already reached the last page"),updateMsgDisplayed()},$scope.prevPage=function(){$scope.pageNum>0?$scope.pageNum--:console.log("It is the first page"),updateMsgDisplayed()}}),app.controller("taskHistoryCtrl",function($scope,$http){$scope.pageSize=14,$scope.ReleaseTaskHistory=[],$scope.currentPage=0;var taskUrl="/user/taskhistory";$http.get(taskUrl).success(function(response){for(var releaseTaskHistory=response.ReleaseTaskHistory,i=0;i<releaseTaskHistory.length;i++)i%$scope.pageSize===0?$scope.ReleaseTaskHistory[Math.floor(i/$scope.pageSize)]=[releaseTaskHistory[i]]:$scope.ReleaseTaskHistory[Math.floor(i/$scope.pageSize)].push(releaseTaskHistory[i])}),$scope.prevPage=function(){$scope.currentPage>0&&$scope.currentPage--},$scope.nextPage=function(){$scope.currentPage<$scope.ReleaseTaskHistory.length-1&&$scope.currentPage++}}),app.controller("userCenterCtrl",function($scope,$http){$scope.userName=!0,$scope.userNickname=getCookie("uploadName");var userUrl="/user/userCenter";$http.get(userUrl).success(function(response){$scope.PhoneNumber=response.personAPP,$scope.userNickname=response.userNickname,$scope.userQQ=response.userQQ,$scope.balance=response.balance,$scope.userFreezingYB=response.userFreezingYB}),$scope.preserve=function(){var userUrl="/user/userSaveInfo";$http.post(userUrl,{userNickname:$scope.userNickname,userQQ:$scope.userQQ}).success(function(response){$scope.errorId=response.errorId,$scope.errorMsg=response.errorMsg,0==response.errorId})}});