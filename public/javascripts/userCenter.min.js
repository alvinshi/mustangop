function logout(){clearCookie("userIdCookie"),clearCookie("username"),location.href="/"}var app=angular.module("yemaWebApp",["ui.router"]),navIndex=6;app.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("inform",{url:"/",templateUrl:"/html/userCenter-infor.html",controller:"userCenterCtrl"}).state("account",{url:"/account",templateUrl:"/html/userCenter-account.html",controller:"userCenterCtrl"}).state("inforManage",{url:"/inforManage",templateUrl:"/html/userCenter-inforManage.html",controller:"inforManageCtrl"}).state("taskHistory",{url:"/taskHistory",templateUrl:"/html/userCenter-taskHistory.html",controller:"taskHistoryCtrl"})}]),app.controller("inforManageCtrl",function(a,b){function c(a,b){var c=new Date(a),d=new Date(b),e=Date.UTC(c.getFullYear(),c.getMonth()+1,c.getDate()),f=Date.UTC(d.getFullYear(),d.getMonth()+1,d.getDate());return parseFloat(e)<parseFloat(f)?c.getDate()-d.getDate()==-1?"昨天":"更早":parseFloat(e)==parseFloat(f)?"今天":parseFloat(e)>parseFloat(f)?"未来":void console.log("fail")}function d(a,b){return a%b==0?parseInt(a/b)+1:parseInt(a/b)+2}function e(){h=a.msgPerPage*a.pageNum,i=h+a.msgPerPage,a.taskMsgDisplayed=a.taskDisplayed.slice(h,i);for(var c=new Array,d=0;d<a.taskMsgDisplayed.length;d++)c.push(a.taskMsgDisplayed[d].id);var e="/user/userCenter/readMsg";b.post(e,{msgIdArray:c}).success(function(a){})}a.userName=!0;var f=new Date,g="/user/userCenter";b.get(g).success(function(b){a.PhoneNumber=b.personAPP,a.userNickname=b.userNickname,a.userQQ=b.userQQ,a.balance=b.balance}),a.preserve=function(){var c="/user/userCenter";b.post(c,{userNickname:a.userNickname,userQQ:a.userQQ}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,0==b.errorId&&(location.href="/user")})},a.pageNum=0,a.msgPerPage=6;var h=0,i=a.msgPerPage,j="/user/userCenter/getMessage";b.get(j).success(function(b){a.myId=b.yourId,console.log(a.myId);var g=b.rtnMsg;a.taskMsg=new Array,a.systemMsg=new Array,a.moneyMsg=new Array,a.unreadMsg=!1,a.unreadTaskMsg=!1,a.unreadSystemMsg=!1,a.unreadMoneyMsg=!1;for(var h=0;h<g.length;h++)"今天"==c(g[h].time,f)?g[h].day="今天":"昨天"==c(g[h].time,f)?g[h].day="昨天":g[h].day=g[h].time,"任务"==g[h].category?(a.taskMsg.push(g[h]),0==g[h].read&&(a.unreadTaskMsg=!0)):"系统"==g[h].category?(a.systemMsg.push(g[h]),0==g[h].read&&(a.unreadSystemMsg=!0)):(a.moneyMsg.push(g[h]),0==g[h].read&&(a.unreadMoneyMsg=!0));(a.unreadTaskMsg||a.unreadMoneyMsg||a.unreadMoneyMsg)&&(a.unreadMsg=!0),a.taskDisplayed=a.taskMsg,a.totalTaskNum=a.taskDisplayed.length,a.totalPageNum=d(a.totalTaskNum,a.msgPerPage),e()}),a.msgClick=function(b){a.pageNum=0,"task"==b?a.taskDisplayed=a.taskMsg:"system"==b?a.taskDisplayed=a.systemMsg:"money"==b&&(a.taskDisplayed=a.moneyMsg),0!=a.taskDisplayed.length&&(h=0,i=a.msgPerPage,e())},a.nextPage=function(){a.pageNum+2<a.totalPageNum?a.pageNum++:console.log("Already reached the last page"),e()},a.prevPage=function(){a.pageNum>0?a.pageNum--:console.log("It is the first page"),e()}}),app.controller("taskHistoryCtrl",function(a,b){a.pageSize=14,a.ReleaseTaskHistory=[],a.currentPage=0;var c="/user/taskhistory";b.get(c).success(function(b){for(var c=b.ReleaseTaskHistory,d=0;d<c.length;d++)d%a.pageSize===0?a.ReleaseTaskHistory[Math.floor(d/a.pageSize)]=[c[d]]:a.ReleaseTaskHistory[Math.floor(d/a.pageSize)].push(c[d])}),a.prevPage=function(){a.currentPage>0&&a.currentPage--},a.nextPage=function(){a.currentPage<a.ReleaseTaskHistory.length-1&&a.currentPage++}}),app.controller("userCenterCtrl",function(a,b){a.userName=!0;var c="/user/userCenter";b.get(c).success(function(b){a.PhoneNumber=b.personAPP,a.userNickname=b.userNickname,a.userQQ=b.userQQ,a.balance=b.balance});var d="/user/mypayYB";b.get(d).success(function(b){a.todyPayYB=b.todyPayYB});var e="/user/myincomeYB";b.get(e).success(function(b){a.usertodyIncome=b.usertodyIncome}),a.preserve=function(){var c="/user/userCenter";b.post(c,{userNickname:a.userNickname,userQQ:a.userQQ}).success(function(b){a.errorId=b.errorId,a.errorMsg=b.errorMsg,0==b.errorId&&(location.href="/user")})}});