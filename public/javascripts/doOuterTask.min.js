var app=angular.module("yemaWebApp",[]),navIndex=4;app.controller("itunesSearchControl",function(a,b){var c="/index";b.get(c).success(function(b){loadNav(),a.userObjectId=b.userObjectId,a.tracknameAPPs=b.tracknameAPPs});var d="doOuterTask/angular";a.isLoadingMyApp=!0;a.progressNum=0,b.get(d).success(function(b){console.log("returned"),a.isLoadingMyApp=!1,a.myApps=b.myApps}),a.searchApp=function(){if(a.isError=0,""!=a.searchUrl){var c="api/itunes/search/"+a.searchKey;a.progressNum=100,console.log("--------- searchApp searchApp"),b.get(c).success(function(b){if(console.log("searchApp"+b),a.appResults=b.appResults,a.progressNum=0,b.errorMsg.length>0)a.isError=1,a.errorMsg=b.errorMsg;else{a.errorMsg="",0==a.appResults.length&&(a.isError=1,a.errorMsg="未找到你搜索的App,请尝试输入它的全称");for(var c=0;c<a.appResults.length;c++){var d=a.appResults[c];d.isMine=!1;for(var e=0;e<a.myApps.length;e++){var f=a.myApps[e];if(f.appleId===d.appleId){d.isMine=!0,console.log(d.appleId+"isMine");break}}}}})}},a.keySearchApp=function(b){var c=window.event?b.keyCode:b.which;13==c&&a.searchApp()},a.chooseMyApp=function(c){var d="myapp/add";console.log(c),b.post(d,{appInfo:c}).success(function(b){if(console.log(b.errorId),0==b.errorId||void 0===b.errorId){var d=0;void 0==a.myApps&&(a.myApps=new Array);for(var e=0;e<a.myApps.length;e++){var f=a.myApps[e];if(f.appleId==c.appleId){d=1;break}}0==d&&(console.log("add app to ui"),a.myApps.push(b.newApp)),a.errorMsg=""}else a.errorMsg=b.errorMsg;a.appResults=[]})},a.releaseBtnClick=function(b){a.prepareReleaseAppid=b},a.releaseMyApp=function(){var c="myapp/delete",d=a.prepareReleaseAppid;console.log("releaseMyApp"+d),b.post(c,{appid:d}).success(function(b){if(0==b.errorId){console.log("remove app if");for(var c=0;c<a.myApps.length;c++){var e=a.myApps[c];if(e.appleId==d){console.log("remove app to ui"),a.myApps.splice(c,1);break}}a.errorMsg=""}else console.log("remove app else"),a.errorMsg=b.errorMsg;a.appResults=[]})}});