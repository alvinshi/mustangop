var app=angular.module("yemaWebApp",[]),navIndex=7;app.controller("itunesSearchControl",function($scope,$http){var indexUrl="/index";$http.get(indexUrl).success(function(response){loadNav(),$scope.userObjectId=response.userObjectId,$scope.tracknameAPPs=response.tracknameAPPs});var appsUrl="doOuterTask/angular";$scope.isLoadingMyApp=!0;$scope.progressNum=0,$http.get(appsUrl).success(function(response){console.log("returned"),$scope.isLoadingMyApp=!1,$scope.myApps=response.myApps}),$scope.searchApp=function(){if($scope.isError=0,""!=$scope.searchUrl){var searchUrl="api/itunes/search/"+$scope.searchKey;$scope.progressNum=100,console.log("--------- searchApp searchApp"),$http.get(searchUrl).success(function(response){if(console.log("searchApp"+response),$scope.appResults=response.appResults,$scope.progressNum=0,response.errorMsg.length>0)$scope.isError=1,$scope.errorMsg=response.errorMsg;else{$scope.errorMsg="",0==$scope.appResults.length&&($scope.isError=1,$scope.errorMsg="未找到你搜索的App,请尝试输入它的全称");for(var i=0;i<$scope.appResults.length;i++){var appRe=$scope.appResults[i];appRe.isMine=!1;for(var j=0;j<$scope.myApps.length;j++){var myApp=$scope.myApps[j];if(myApp.appleId===appRe.appleId){appRe.isMine=!0,console.log(appRe.appleId+"isMine");break}}}}})}},$scope.keySearchApp=function(e){var keycode=window.event?e.keyCode:e.which;13==keycode&&$scope.searchApp()},$scope.chooseMyApp=function(appInfo){var searchUrl="myapp/add";console.log(appInfo),$http.post(searchUrl,{appInfo:appInfo}).success(function(response){if(console.log(response.errorId),0==response.errorId||void 0===response.errorId){var flag=0;void 0==$scope.myApps&&($scope.myApps=new Array);for(var i=0;i<$scope.myApps.length;i++){var app=$scope.myApps[i];if(app.appleId==appInfo.appleId){flag=1;break}}0==flag&&(console.log("add app to ui"),$scope.myApps.push(response.newApp)),$scope.errorMsg=""}else $scope.errorMsg=response.errorMsg;$scope.appResults=[]})},$scope.releaseBtnClick=function(appid){$scope.prepareReleaseAppid=appid},$scope.releaseMyApp=function(){var searchUrl="myapp/delete",appid=$scope.prepareReleaseAppid;console.log("releaseMyApp"+appid),$http.post(searchUrl,{appid:appid}).success(function(response){if(0==response.errorId){console.log("remove app if");for(var i=0;i<$scope.myApps.length;i++){var app=$scope.myApps[i];if(app.appleId==appid){console.log("remove app to ui"),$scope.myApps.splice(i,1);break}}$scope.errorMsg=""}else console.log("remove app else"),$scope.errorMsg=response.errorMsg;$scope.appResults=[]})}});